$def with(work, mobile=False)

$ rating_stats = work and work.get_rating_stats() or {}
$ stats_by_bookshelf = work and work.get_num_users_by_bookshelf() or {}
$ avg = rating_stats.get('avg_rating')
$ ratings_count = rating_stats.get('num_ratings', 0)
$ want_to_read_count = "{:,}".format(stats_by_bookshelf.get('want-to-read', 0))
$ currently_reading_count = "{:,}".format(stats_by_bookshelf.get('currently-reading', 0))
$ already_read_count = "{:,}".format(stats_by_bookshelf.get('already-read', 0))
$ id = '--mobile' if mobile else ''

<ul class="readers-stats  $review_count_class" itemprop="aggregateRating" itemscope itemtype="https://schema.org/AggregateRating">
  <li class="avg-ratings" onclick="location.href='#starRatingSection';" data-ol-link-track="StarRating|StatsComponentClick">
    $if avg:
      $ stats_decimal = (float(avg))-(int(avg))
      $:('<span class="readers-stats__star">★</span>' * int(avg))
      $if (stats_decimal >= 0.5) and (stats_decimal < 1):
        $:('<span class="readers-stats__star--half">★</span>')
      <span itemprop="ratingValue">$avg</span>
      <span class="dot">·</span>
  </li>
  $if want_to_read_count > 0:
    <li class="reading-log-stat"><span class="readers-stats__stat">$want_to_read_count</span> <span class="readers-stats__label">$_("Want to read")</span></li>
  $if currently_reading_count > 0:
    <li class="reading-log-stat"><span class="readers-stats__stat">$currently_reading_count</span> <span class="readers-stats__label">$_("Currently reading")</span></li>
  $if already_read_count > 0:
    <li class="reading-log-stat"><span class="readers-stats__stat">$already_read_count</span> <span class="readers-stats__label">$_("Have read")</span></li>
</ul>
